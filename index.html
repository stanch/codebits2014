<!doctype html>
<html lang="en">

  <head>
    <meta charset="utf-8">

    <title>Android And Functional Programming For Great Good™</title>

    <meta name="description" content="Codebits2014 Slides">
    <meta name="author" content="Nick">

    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <link rel="stylesheet" href="css/reveal.min.css">
    <link rel="stylesheet" href="css/theme/default.css" id="theme">

    <!-- Typekit -->
    <script type="text/javascript" src="//use.typekit.net/gsg2lcs.js"></script>
    <script type="text/javascript">try{Typekit.load();}catch(e){}</script>

    <!-- For syntax highlighting -->
    <link rel="stylesheet" href="lib/css/zenburn.css">

    <!-- If the query includes 'print-pdf', use the PDF print sheet -->
    <script>
      document.write( '<link rel="stylesheet" href="css/print/' + ( window.location.search.match( /print-pdf/gi ) ? 'pdf' : 'paper' ) + '.css" type="text/css" media="print">' );
    </script>

    <!--[if lt IE 9]>
    <script src="lib/js/html5shiv.js"></script>
    <![endif]-->
  </head>

  <body>

    <div class="reveal">

      <!-- Any section element inside of this container is displayed as a slide -->
      <div class="slides">
        <section>
          <h2>Android &amp;<br/>Functional Programming<br/>For Great Good™</h2>
          <h4>
            Nick <a href="https://twitter.com/stanchme">@stanchme</a><br/>
            <a href="http://github.com/stanch">http://github.com/stanch</a>
          </h4>
        </section>

        <section data-markdown>
          ## What is Android?
        </section>

        <section>
          <h2>A kind of candy?</h2>
          <img src="http://www.android.com/new/images/banners/meet3-1600.jpg" width="800px"/>
        </section>

        <section data-markdown>
          ## What is functional programming?
        </section>

        <section>
          <h2>Composability</h2>
          <div style="overflow: hidden; width: 400px; margin: 0 auto"><img src="http://m1.behance.net/rendition/modules/57033867/disp/28b9fc09596119d553e2b81245fee3ef.png" height="200px" style="margin: -60px 0 0 0"/></div>
          ↓<br />
          <img src="http://m1.behance.net/rendition/modules/57026595/disp/0b8fae7a095dcafbdfc9aceeff342e66.png" width="379px"/>
        </section>

        <section>
          <section data-transition="none">
            <h2>Abstraction</h2>
            <img src="http://mrlagency.co.uk/wp-content/uploads/2012/11/Lego.jpg" height="300px" style="vertical-align: middle" />
            →
            <img src="https://encrypted-tbn3.gstatic.com/images?q=tbn:ANd9GcQQcKksQdey43463zaYqpXpDzQth5VfyDpWvzPI5k_5gj-LfoMJ" height="300px" style="vertical-align: middle" />
          </section>
          <section data-transition="none">
            <h2>Abstraction</h2>
            <img src="http://mrlagency.co.uk/wp-content/uploads/2012/11/Lego.jpg" height="300px" style="vertical-align: middle" />
            →
            <img src="https://encrypted-tbn3.gstatic.com/images?q=tbn:ANd9GcTneu0-3bTM33_B_JbDXuObghYhh6hosSeV_XR0SKIA-eo-fpXo" height="300px" style="vertical-align: middle" />
          </section>
        </section>

        <section data-markdown>
          ## Now it makes sense

          ![hans](http://static.bips.channel4.com/bips/orig/videos/2776180868001.jpg)

          > “Plumbing’s just Lego, innit? Water Lego...”

          — Superhans, *Peep Show*
        </section>

        <section data-markdown>
          ## Tools of the trade
        </section>

        <section data-markdown>
          <script type="text/template">
            ## Scala [[+]](http://scala-lang.org/)

            ![scala](http://scala-lang.org/resources/img/smooth-spiral.png)

            * Compiles to Java Bytecode
            * *Object-Oriented* + *Functional*
          </script>
        </section>

        <section data-markdown>
          ## Who uses Scala?
          
          ![users](scalausers.png)
        </section>

        <section>
          <section data-markdown data-transition="none">
            ## Values

            ```scala
            val x = 4
            ```
          </section>
          <section data-markdown data-transition="none">
            ## Values

            ```scala
            val x: Int = 4
            ```
          </section>
        </section>

        <section>
          <section data-markdown data-transition="none">
            ## Methods

            ```scala
            def add(x: Int, y: Int) = x + y
            ```
          </section>
          <section data-markdown data-transition="none">
            ## Methods

            ```scala
            def add(x: Int, y: Int): Int = {
              x + y
            }
            ```
          </section>
        </section>

        <section>
          <section data-markdown data-transition="none">
            ## Anonymous functions

            ```scala
            (x: Int) ⇒ x + 3
            ```
          </section>
          <section data-markdown data-transition="none">
            ## Anonymous functions

            ```scala
            x ⇒ x + 3
            ```
          </section>
          <section data-markdown data-transition="none">
            ## Anonymous functions

            ```scala
            _ + 3
            ```
          </section>
        </section>

        <section>
          <h2>Syntax-bending</h2>
          <div class="fragment" data-markdown>
            ```scala
            5.add(5) ⇔ 5 add 5
            ```
          </div>
          <div class="fragment" data-markdown>
            ```scala
            bird.♫("lala") ⇔ bird ♫ "lala"
            ```
          </div>
          <div class="fragment" data-markdown>
            ```scala
            say("Hi!") ⇔ say { "Hi!" }
            ```
          </div>
        </section>

        <section data-markdown>
          ## Let’s see it in action!
        </section>

        <section>
          <section>
            <h2>A cartographic case</h2>
            <img src="http://www.frugals.ca/wp-content/uploads/2013/06/13935500-travel-the-world-monuments-concept.jpg" height="300px" style="vertical-align: middle"/>
            →
            <img src="http://daringfireball.net/misc/2012/12/android-google-maps.png" height="300px" style="vertical-align: middle"/>
          </section>
          <section data-markdown>
            ## A cartographic case

            > Given a list of cities,

            > **select** those with a river,

            > **take** top-**5** of

            > the **most populated ones**, and

            > put **each** of them on the map.
          </section>
        </section>

        <section data-markdown>
          ## Code poetry? [[+]](http://twitter.github.io/scala_school/collections.html)

          ```scala
          cities
            .filter(_.hasRiver)
            .sortBy(_.population)
            .take(5)
            .foreach { c ⇒
              addToMap(c.name, c.coordinates)
            }
          ```
        </section>

        <section data-markdown>
          ## Not too early!

          > Declare a property you need,

          > but do not call any APIs

          > before the UI is ready
        </section>

        <section data-markdown>
          ## Some laziness helps 

          ```scala
          lazy val title =
            getArguments.getString("title")
          ```
        </section>

        <section data-markdown>
          ## What about all those `null`s?
        </section>

        <section data-markdown>
          ## Code haiku! [[+]](http://danielwestheide.com/blog/2012/12/19/the-neophytes-guide-to-scala-part-5-the-option-type.html)

          ```scala
          lazy val title =
            Option(getArguments)
            .flatMap(a ⇒ Option(a.getString("title")))
            .getOrElse("Hello")
          ```
        </section>

        <section data-markdown>
          ## Get off my lawn!

          > Run a difficult computation

          > **outside the main thread**

          > and do something with the result

          > when it’s ready.
        </section>

        <section>
          <h2>The future <a href="http://docs.scala-lang.org/overviews/core/futures.html">[+]</a></h2>

          <div class="fragment" data-markdown>
            ```scala
            val result = Future {
              val x = longComputation(41.5)
              x + 5
            }
            ```
          </div>
          <div class="fragment" data-markdown>
            ```scala
            result onComplete {
              case Success(x) ⇒ doSomething(x)
              case Failure(t) ⇒ handle(t)
            }
            ```
          </div>
        </section>

        <section>
          <h2>What is a future?</h2>
          <table class="future">
            <tr>
              <td style="width: 10em">many seconds</td>
              <td>⇒ 42</td>
            </tr>
          </table>
        </section>

        <section data-markdown>
          > “Don’t put off until tomorrow what you can do today”

          — Benjamin Franklin
        </section>

         <section>
          <section>
            <h2>Operating in the future</h2>
            <table class="future">
              <tr>
                <td style="width: 10em">many seconds</td>
                <td>⇒ 42</td>
              </tr>
            </table>
            ↓
            <table class="future">
              <tr>
                <td style="width: 10.6em">many seconds</td>
                <td>⇒ 43</td>
              </tr>
            </table>
          </section>
          <section data-markdown>
            ## Operating in the future [[+]](http://docs.scala-lang.org/overviews/core/futures.html)

            ```scala
            val fortyTwo = Future { ... }

            val fortyThree = fortyTwo.map(_ + 1)

            fortyThree onComplete { ... }
            ```
          </section>
        </section>

        <section>
          <section>
            <h2>Async orchestration</h2>
             <table class="future">
              <tr>
                <td style="width: 10em">get from database</td>
                <td>⇒ $30</td>
              </tr>
            </table>
            *
            <table class="future">
              <tr>
                <td style="width: 5em">ask google</td>
                <td>⇒ 0.72 €/$</td>
              </tr>
            </table>
            ↓
            <table class="future">
              <tr>
                <td style="width: 12em">a few seconds later</td>
                <td>⇒ €21.6</td>
              </tr>
            </table>
          </section>
          <section data-markdown>
            ## Async orchestration [[+]](http://docs.scala-lang.org/sips/pending/async.html)

            ```scala
            val euros = async {
              val d = await(getDollarsFromDb)
              val r = await(googleConversionRate)
              d * r
            }
            ```
          </section>
        </section>

        <section data-markdown>
          ## Wait, what about GUI?
        </section>

        <section data-markdown>
          ## Android XML layouts

          ![xml](xml.png)

          * Verbose
          * XML + code boilerplate
          * Only one per file
          * No namespacing
        </section>

        <section data-markdown>
          ## Macroid [[+]](https://github.com/macroid/macroid)

          > Experimental modular functional UI language for Android, written in Scala.
        </section>

        <section>
          <section data-markdown>
            ## Bricks

            ```scala
            w[Button]
            ```
          </section>
          <section data-markdown>
            ## Bricks

            ```scala
            l[LinearLayout](
              w[Button],
              w[TextView]
            )
            ```
          </section>
          <section data-markdown>
            ## Bricks

            ```scala
            val brick1 = w[Button]
            val brick2 = w[TextView]

            l[LinearLayout](
              brick1, brick2
            )
            ```
          </section>
        </section>

        <section>
          <section data-markdown>
            ## Tweaking

            ```scala
            w[TextView] <~ text("Hello")
            ```
          </section>
          <section data-markdown>
            ## Tweaking
            
            ```scala
            def largeText(str: String) =
              text(str) +
              TextSize.large +
              padding(left = 8 dp)

            w[TextView] <~ largeText("Hello")
            ```
          </section>
        </section>

        <section data-markdown class="smaller-code">
          ## A complete example

          ```scala
          var greeting = slot[TextView]
 
          l[LinearLayout](
            w[Button] <~
              text("Greet me!") <~
              On.click {
                greeting <~ show
              },
              
            w[TextView] <~
              text("Hello there") <~
              wire(greeting) <~ hide 
          )
          ```
        </section>

        <section data-markdown>
          ## What about adaptivity?
        </section>

        <section data-markdown>
          ## The Android way

          * A folder per screen size
          * Limited layout reuse
        </section>

        <section data-markdown>
          ## Media queries

          ```scala
          val textStyle =
            widerThan(400 dp) ?
            TextSize.large |
            TextSize.medium

          w[TextView] <~ textStyle
          ```
        </section>

        <section data-markdown>
          ## New ways of expression

          ```scala
          ? <~ ?
          ```
        </section>

        <section data-markdown>
          ## Optional tweaking

          ```scala
          onlySeenInHD <~ (hdpi ? show)
          ```
        </section>

        <section data-markdown>
          ## Batch tweaking

          ```scala
          List(textView1, textView2) <~ hide
          ```
        </section>

        <section>
          <section>
            <h2>Tweaking from the future</h2>
            <table class="future">
              <tr>
                <td style="width: 10em">many seconds</td>
                <td>⇒ "Hello"</td>
              </tr>
            </table>
            ↓
            <table class="future">
              <tr>
                <td style="width: 10.2em">many seconds</td>
                <td>⇒ text("Hello")</td>
              </tr>
            </table>
          </section>
          <section data-markdown>
            ## Tweaking from the future

            ```scala
            val futureCaption = Future {
              Thread.sleep(5000)
              text("Hello")
            }

            myTextView <~ futureCaption
            ```
          </section>
        </section>

        <section data-markdown>
          ## And now for something completely different...

          ![Cleese](http://static.tvtropes.org/pmwiki/pub/images/and-now-for-something-completely-different_2729.jpg)
        </section>

        <section data-markdown>
          ## Starting procedures

          1. Install [SBT](http://www.scala-sbt.org/) (build tool)
          2. Install [Intellij IDEA](http://www.jetbrains.com/idea/) (or Android Studio)
          3. Add [Scala](http://plugins.jetbrains.com/plugin/?id=1347) and [SBT](http://plugins.jetbrains.com/plugin/5007?pr=idea) plugins to IDEA
          4. Add [Android](https://github.com/pfn/android-sdk-plugin) and [IDEA](https://github.com/mpeltonen/sbt-idea) plugins to SBT
          5. Write a build file
          6. Generate IDE project files
          7. Run! *-or-* In utter rage, post in the [Mailing list](https://groups.google.com/forum/#!forum/scala-on-android)
        </section>

        <section data-markdown class="smaller-code">
          ## The build file

          ```scala
          name := "Project-name"

          version := "1.0"

          platformTarget in Android := "android-19"

          libraryDependencies ++= Seq(
            "com.loopj.android" % "android-async-http" % "1.4.4",
            "com.android.support" % "support-v13" % "19.1.0",
            aar("com.google.android.gms" % "play-services" % "4.0.30")
          )
          ```
        </section>

        <section data-markdown>
          ## Connecting the IDE

          ```
          sbt
          > gen-idea
          ```
        </section>

        <section data-markdown>
          (live IDE demo)
        </section>

        <section data-markdown>
          ## Some flies in the ointment

          #### Scala library is around 5 MB
          ↓
          #### Squeeze it with ProGuard
          ↓
          #### Build time goes up to 1 min / 10K LOC;
          #### ProGuard config takes some effort

          ![fly](http://www.picgifs.com/graphics/f/flies/graphics-flies-254732.gif)
        </section>

        <section data-markdown>
          <script type="text/template">
            ## Learn more

            * [Scala website](http://scala-lang.org/)
            * [*The* Scala book](http://www.artima.com/pins1ed/)
            * [SBT website](http://www.scala-sbt.org/)
            * [Scala+Android mailing list](https://groups.google.com/forum/#!forum/scala-on-android)
            * [SBT Android plugin](https://github.com/pfn/android-sdk-plugin)
            * [Macroid website](https://github.com/macroid/macroid)

            This presentation: http://stanch.github.io/codebits2014
          </script>
        </section>

      </div>
    </div>

    <script src="lib/js/head.min.js"></script>
    <script src="js/reveal.min.js"></script>

    <script>

      // Full list of configuration options available here:
      // https://github.com/hakimel/reveal.js#configuration
      Reveal.initialize({
        controls: true,
        progress: true,
        history: true,
        center: true,

        theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
        backgroundTransition: 'slide',
        transition: 'linear',

        // Optional libraries used to extend on reveal.js
        dependencies: [
          { src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
          { src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
          { src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
          { src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
          { src: 'plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
          { src: 'plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }
        ]
      });

    </script>

  </body>
</html>
